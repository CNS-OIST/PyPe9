{# This template sets up residual method required by the IDA solver

   Authors: Ivan Raikov and Thomas G. Close
   Copyright Okinawa Institute of Science and Technology Graudate University 2014
#}
{% if (ode_solver == "ida") %}

//----------------------------------------------------//
// This section was generated from NEST-residual.tmpl //
//----------------------------------------------------//
extern "C" int {{ModelName}}_residual (double t, N_Vector y, N_Vector yp, N_Vector f, void* pnode)
{
   int status; 

   // cast the node ptr to an object of the proper type
   assert(pnode);
   const {{ModelName}} & node =  *(reinterpret_cast<{{ModelName}}*>(pnode));
   {{ModelName}} & vnode =  *(reinterpret_cast<{{ModelName}}*>(pnode));

   N_Vector y1 = vnode.B_.y1;
             
   status = {{ModelName}}_dynamics (t, y, y1, pnode);

   {% for i in xrange(num_states) %}
   ITEM(f, {{i}}) = ITEM(y1, {{i}}) - ITEM(yp, {{i}})
   {% endfor %}

   return status;
}
//-------------- NEST-residual.tmpl ------------------//
{% endif %}