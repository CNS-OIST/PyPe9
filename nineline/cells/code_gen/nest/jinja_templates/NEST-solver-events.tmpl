{#
   This template generates the solver event portion of the update loop.

   Template variables are:

   - ModelName: the name of the current system
   - synapticEventDefs - a list of synaptic event objects that have the following fields:

     - pscName - descriptive name (label) of the post-synaptic conductance component
     - pscId - unique identifier of the post-synaptic conductance component

   Authors: Ivan Raikov and Thomas G. Close
   Copyright Okinawa Institute of Science and Technology Graudate University 2014
#}

//---------------------------------------------------------//
// This section was generated from NEST-solver-events.tmpl //
//---------------------------------------------------------//

  int events = 0;

{% for name in synaptic_events %}
  events = events + {{name}}_transients (lag);
{% endfor %}

{% if (ode_method == "cvode") %}

  /* Reinitializes CVode state if any synaptic events have occurred */
  if (events > 0)
  {
    int status = CVodeReInit (B_.sys_, tt, B_.y);
    if (check_flag(&status, "CVodeReInit", 1)) throw CVodeSolverFailure (get_name(), status);
  }

{% elif (ode_method == "ida") %}

  /* Reinitializes IDA state if any synaptic events have occurred */
  if (events > 0)
  {
     int status = IDAReInit (B_.sys_, tt, B_.y, B_.yp);
     if (check_flag(&status, "IDAReInit", 1)) throw IDASolverFailure (get_name(), status);
  }

{% elif (ode_method == "gsl") %}

  /* Resets the GSL stepping function if any synaptic events have occurred */
  if (events > 0)
  {
     gsl_odeiv2_step_reset (B_.s_);
  }

{% endif %}

//------------  NEST-solver-events.tmpl ---------------------//