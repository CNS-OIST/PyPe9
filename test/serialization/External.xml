<?xml version='1.0' encoding='UTF-8'?>
<NineML xmlns="http://nineml.net/9ML/1.0">
  <Selection name="All">
    <Concatenate>
      <Item index="0">
        <Reference>Inh</Reference>
      </Item>
      <Item index="1">
        <Reference>Exc</Reference>
      </Item>
    </Concatenate>
  </Selection>
  <ComponentArray name="Exc">
    <Size>4</Size>
    <Reference>Exc</Reference>
  </ComponentArray>
  <ComponentArray name="Ext">
    <Size>5</Size>
    <Reference>Ext</Reference>
  </ComponentArray>
  <ComponentArray name="Inh">
    <Size>1</Size>
    <Reference>Inh</Reference>
  </ComponentArray>
  <EventConnectionGroup name="External">
    <Source port="spike_output__cell">
      <Reference>Ext</Reference>
    </Source>
    <Destination port="input_spike__psr__External">
      <Reference>All</Reference>
    </Destination>
    <Connectivity>
      <Reference>OneToOne</Reference>
    </Connectivity>
    <Delay>
      <Quantity units="ms">
        <SingleValue>1.5</SingleValue>
      </Quantity>
    </Delay>
  </EventConnectionGroup>
  <MultiDynamicsWithSynapses name="Exc_Dynamics">
    <Cell>
      <MultiDynamics name="Exc_Dynamics">
        <SubDynamics name="cell">
          <Reference>LeakyIntegrateAndFire</Reference>
        </SubDynamics>
        <AnalogSendPortExposure name="refractory_end__cell" sub_component="cell" port="refractory_end"/>
        <AnalogSendPortExposure name="v__cell" sub_component="cell" port="v"/>
        <AnalogReducePortExposure name="i_synaptic__cell" sub_component="cell" port="i_synaptic"/>
        <EventSendPortExposure name="spike_output__cell" sub_component="cell" port="spike_output"/>
        <Annotations>
          <Validation dimensionality="True"/>
        </Annotations>
      </MultiDynamics>
    </Cell>
    <Annotations>
      <Validation dimensionality="True"/>
    </Annotations>
  </MultiDynamicsWithSynapses>
  <MultiDynamicsWithSynapses name="Ext_Dynamics">
    <Cell>
      <MultiDynamics name="Ext_Dynamics">
        <SubDynamics name="cell">
          <Reference>Poisson</Reference>
        </SubDynamics>
        <EventSendPortExposure name="spike_output__cell" sub_component="cell" port="spike_output"/>
        <Annotations>
          <Validation dimensionality="True"/>
        </Annotations>
      </MultiDynamics>
    </Cell>
    <Annotations>
      <Validation dimensionality="True"/>
    </Annotations>
  </MultiDynamicsWithSynapses>
  <MultiDynamicsWithSynapses name="Inh_Dynamics">
    <Cell>
      <MultiDynamics name="Inh_Dynamics">
        <SubDynamics name="cell">
          <Reference>LeakyIntegrateAndFire</Reference>
        </SubDynamics>
        <AnalogSendPortExposure name="refractory_end__cell" sub_component="cell" port="refractory_end"/>
        <AnalogSendPortExposure name="v__cell" sub_component="cell" port="v"/>
        <AnalogReducePortExposure name="i_synaptic__cell" sub_component="cell" port="i_synaptic"/>
        <EventSendPortExposure name="spike_output__cell" sub_component="cell" port="spike_output"/>
        <Annotations>
          <Validation dimensionality="True"/>
        </Annotations>
      </MultiDynamics>
    </Cell>
    <Annotations>
      <Validation dimensionality="True"/>
    </Annotations>
  </MultiDynamicsWithSynapses>
  <ComponentClass name="LeakyIntegrateAndFire">
    <Parameter name="R" dimension="resistance"/>
    <Parameter name="refractory_period" dimension="time"/>
    <Parameter name="tau" dimension="time"/>
    <Parameter name="v_reset" dimension="voltage"/>
    <Parameter name="v_threshold" dimension="voltage"/>
    <AnalogReducePort name="i_synaptic" dimension="current" operator="+"/>
    <EventSendPort name="spike_output"/>
    <AnalogSendPort name="refractory_end" dimension="time"/>
    <AnalogSendPort name="v" dimension="voltage"/>
    <Dynamics>
      <StateVariable name="refractory_end" dimension="time"/>
      <StateVariable name="v" dimension="voltage"/>
      <Regime name="refractory">
        <OnCondition target_regime="subthreshold">
          <Trigger>
            <MathInline>t &gt; refractory_end</MathInline>
          </Trigger>
        </OnCondition>
      </Regime>
      <Regime name="subthreshold">
        <TimeDerivative variable="v">
          <MathInline>(R*i_synaptic - v)/tau</MathInline>
        </TimeDerivative>
        <OnCondition target_regime="refractory">
          <Trigger>
            <MathInline>v &gt; v_threshold</MathInline>
          </Trigger>
          <StateAssignment variable="refractory_end">
            <MathInline>refractory_period + t</MathInline>
          </StateAssignment>
          <StateAssignment variable="v">
            <MathInline>v_reset</MathInline>
          </StateAssignment>
          <OutputEvent port="spike_output"/>
        </OnCondition>
      </Regime>
    </Dynamics>
    <Annotations>
      <Validation dimensionality="True"/>
    </Annotations>
  </ComponentClass>
  <ComponentClass name="Poisson">
    <Parameter name="rate" dimension="per_time"/>
    <EventSendPort name="spike_output"/>
    <Dynamics>
      <StateVariable name="t_next" dimension="time"/>
      <Regime name="default">
        <OnCondition target_regime="default">
          <Trigger>
            <MathInline>t &gt; t_next</MathInline>
          </Trigger>
          <StateAssignment variable="t_next">
            <MathInline>one_second*random.exponential(one_second*rate) + t</MathInline>
          </StateAssignment>
          <OutputEvent port="spike_output"/>
        </OnCondition>
      </Regime>
      <Constant name="one_second" units="s">1.0</Constant>
    </Dynamics>
    <Annotations>
      <Validation dimensionality="True"/>
    </Annotations>
  </ComponentClass>
  <Component name="nrn">
    <Definition url="/Users/tclose/git/ninemlcatalog/xml/neuron/LeakyIntegrateAndFire.xml">LeakyIntegrateAndFire</Definition>
    <Property name="R" units="Mohm">
      <SingleValue>1.5</SingleValue>
    </Property>
    <Property name="refractory_period" units="ms">
      <SingleValue>2.0</SingleValue>
    </Property>
    <Property name="tau" units="ms">
      <SingleValue>20.0</SingleValue>
    </Property>
    <Property name="v_reset" units="mV">
      <SingleValue>10.0</SingleValue>
    </Property>
    <Property name="v_threshold" units="mV">
      <SingleValue>20.0</SingleValue>
    </Property>
    <Initial name="refractory_end" units="ms">
      <SingleValue>0.0</SingleValue>
    </Initial>
    <Initial name="v" units="mV">
      <RandomDistributionValue>
        <Reference>uniform_rest_to_threshold</Reference>
      </RandomDistributionValue>
    </Initial>
  </Component>
  <Component name="stim">
    <Definition url="/Users/tclose/git/ninemlcatalog/xml/input/Poisson.xml">Poisson</Definition>
    <Property name="rate" units="per_s">
      <SingleValue>300.0</SingleValue>
    </Property>
    <Initial name="t_next" units="ms">
      <RandomDistributionValue>
        <Reference>exponential_beta</Reference>
      </RandomDistributionValue>
    </Initial>
  </Component>
  <Component name="OneToOne">
    <Definition url="/Users/tclose/git/ninemlcatalog/xml/connectionrule/OneToOne.xml">OneToOne</Definition>
  </Component>
  <Component name="exponential_beta">
    <Definition url="/Users/tclose/git/ninemlcatalog/xml/randomdistribution/Exponential.xml">ExponentialDistribution</Definition>
    <Property name="rate" units="unitless">
      <SingleValue>52638.7053487</SingleValue>
    </Property>
  </Component>
  <Component name="uniform_rest_to_threshold">
    <Definition url="/Users/tclose/git/ninemlcatalog/xml/randomdistribution/Uniform.xml">UniformDistribution</Definition>
    <Property name="maximum" units="unitless">
      <SingleValue>20.0</SingleValue>
    </Property>
    <Property name="minimum" units="unitless">
      <SingleValue>0.0</SingleValue>
    </Property>
  </Component>
  <Dimension name="current" i="1"/>
  <Dimension name="dimensionless"/>
  <Dimension name="per_time" t="-1"/>
  <Dimension name="resistance" m="1" l="2" t="-3" i="-2"/>
  <Dimension name="time" t="1"/>
  <Dimension name="voltage" m="1" l="2" t="-3" i="-1"/>
  <Unit symbol="Mohm" dimension="resistance" power="6"/>
  <Unit symbol="mV" dimension="voltage" power="-3"/>
  <Unit symbol="ms" dimension="time" power="-3"/>
  <Unit symbol="per_s" dimension="per_time" power="0"/>
  <Unit symbol="s" dimension="time" power="0"/>
  <Unit symbol="unitless" dimension="dimensionless" power="0"/>
</NineML>
